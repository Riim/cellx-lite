!(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.cellx=e()})(this,(function(){"use strict";function t(){return String(++v)}function e(t,e){for(var n=Object.getOwnPropertyNames(e),i=0,s=n.length;i<s;i++){var r=n[i];Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}return t}function n(t){var n;t.Extends?(n=t.Extends,delete t.Extends):n=Object;var i;b.call(t,"constructor")?(i=t.constructor,delete t.constructor):i=n==Object?function(){}:function(){return n.apply(this,arguments)};var s=i.prototype=Object.create(n.prototype);return t.Implements&&(t.Implements.forEach((function(t){"function"==typeof t?(Object.keys(t).forEach((function(e){Object.defineProperty(i,e,Object.getOwnPropertyDescriptor(t,e))})),e(s,t.prototype)):e(s,t)})),delete t.Implements),Object.keys(n).forEach((function(t){Object.defineProperty(i,t,Object.getOwnPropertyDescriptor(n,t))})),t.Static&&(e(i,t.Static),delete t.Static),void 0===i.extend&&(i.extend=d),e(s,t),Object.defineProperty(s,"constructor",{configurable:!0,writable:!0,value:i}),i}function i(t,e){return t<e?-1:t>e?1:0}function s(){}function r(){if(X){X=!1,q=!0;for(var t=H.get(G);;){var e=t&&t.shift();if(e){var n=e._level,i=e._changeEvent;if(!i){if(n>G||e._levelInRelease==-1){if(!t.length){if(G==J)break;t=H.get(++G)}continue}if(e.pull(),n=e._level,i=e._changeEvent,n>G){t.length||(t=H.get(++G));continue}}if(e._levelInRelease=-1,i){var s=G;e._fixedValue=e._value,e._changeEvent=null,e._handleEvent(i);for(var r=e._pushingIndex,h=e._slaves,a=0,o=h.length;a<o;a++){var l=h[a];l._level<=n&&(l._level=n+1),r>=l._pushingIndex&&(l._pushingIndex=r,l._changeEvent=null,l._addToRelease())}if(G!=s){t=H.get(G);continue}}if(!t.length){if(G==J)break;t=H.get(++G)}}else{if(G==J)break;t=H.get(++G)}}if(G=Y,J=-1,q=!1,W++,N){var u=N;N=null;for(var c=0,f=u.length;c<f;c++)u[c]()}}}function h(t,e){t.push(e)}function a(){var t=E.console;(t&&t.error||s).call(t||E,T.call(arguments,(function(t){return t===Object(t)&&t.stack||t})).join(" "))}function o(t,e){return new R(t,e)}function l(t,e){return new L(t,e)}function u(t,e,n){var i="_"+e;return t[i]=n instanceof nt?n:new nt(n,{owner:t}),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return this[i].get()},set:function(t){this[i].set(t)}}),t}function c(t,e){return Object.keys(e).forEach((function(n){u(t,n,e[n])})),t}function f(t,e,n){return 3==arguments.length?u(t,e,n):c(t,e),t}var _={_handler:null,setHandler:function(t){this._handler=t},log:function(){this._handler.apply(this,arguments)}},v=0,g=Function("return this;")().Symbol;g||(g=function(e){return"__"+e+"_"+Math.floor(1e9*Math.random())+"_"+t()+"__"},g.iterator=g("Symbol.iterator"));var d,p=g,m=p("cellx.uid"),y=p("cellx.cells"),E=Function("return this;")(),x=Object.is||function(t,e){return 0===t&&0===e?1/t==1/e:t===e||t!=t&&e!=e},b=Object.prototype.hasOwnProperty;d=function(t){return t.Extends=this,n(t)};var w=E.Map;if(!w||w.toString().indexOf("[native code]")==-1){var V={value:void 0};w=n({constructor:function(t){if(this._entries=Object.create(null),this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,n=t.length;e<n;e++)this.set(t[e][0],t[e][1])},has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||V).value},set:function(t,e){var n=this._entries,i=this._getValueStamp(t);if(n[i])n[i].value=e;else{var s=n[i]={key:t,keyStamp:i,value:e,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},delete:function(t){var e=this._getValueStamp(t),n=this._entries[e];if(!n)return!1;if(--this.size){var i=n.prev,s=n.next;i?i.next=s:this._first=s,s?s.prev=i:this._last=i}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(e){if(!b.call(e,m)){if(!Object.isExtensible(e)){var n,i=this._objectStamps;for(n in i)if(b.call(i,n)&&i[n]==e)return n;return n=t(),i[n]=e,n}Object.defineProperty(e,m,{value:t()})}return e[m]},forEach:function(t,e){for(var n=this._first;n;){t.call(e,n.value,n.key,this);do{n=n.next}while(n&&!this._entries[n.keyStamp])}},toString:function(){return"[object Map]"}}),[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]].forEach((function(t){var e=t[1];w.prototype[t[0]]=function(){var t,n=this._entries,i=!1,s=this;return{next:function(){if(!i){if(t)do{t=t.next}while(t&&!n[t.keyStamp]);else t=s._first;if(t)return{value:e(t),done:!1};i=!0}return{value:void 0,done:!0}}}}}))}w.prototype[p.iterator]||(w.prototype[p.iterator]=w.prototype.entries);var I=w,O=p("cellx.EventEmitter.inner"),C={},S=n({Static:{KEY_INNER:O},constructor:function(){this._events=new I},getEvents:function(t){var e;return t?(e=this._events.get(t),e?e._isEvent===C?[e]:e:[]):(e=Object.create(null),this._events.forEach((function(t,n){e[n]=t._isEvent===C?[t]:t})),e)},on:function(t,e,n){if("object"==typeof t){n=arguments.length>=2?e:this;var i=t;for(t in i)this._on(t,i[t],n)}else this._on(t,e,arguments.length>=3?n:this);return this},off:function(t,e,n){var i=arguments.length;if(i)if("object"==typeof t){n=i>=2?e:this;var s=t;for(t in s)this._off(t,s[t],n)}else this._off(t,e,i>=3?n:this);else this._events.clear();return this},_on:function(t,e,n){var i=t.indexOf(":");if(i!=-1){var s=t.slice(i+1);(this["_"+s]||(this[s],this["_"+s])).on(t.slice(0,i),e,n)}else{var r=this._events.get(t),h={_isEvent:C,listener:e,context:n};r?r._isEvent===C?this._events.set(t,[r,h]):r.push(h):this._events.set(t,h)}},_off:function(t,e,n){var i=t.indexOf(":");if(i!=-1){var s=t.slice(i+1);(this["_"+s]||(this[s],this["_"+s])).off(t.slice(0,i),e,n)}else{var r=this._events.get(t);if(!r)return;var h,a=r._isEvent===C;if(a||1==r.length)h=a?r:r[0],h.listener!=e&&h.listener[O]!==e||h.context!==n||this._events.delete(t);else for(var o=r.length;o;)if(h=r[--o],(h.listener==e||h.listener[O]===e)&&h.context===n){r.splice(o,1);break}}},once:function(t,e,n){function i(){return this._off(t,i,n),e.apply(this,arguments)}return arguments.length<3&&(n=this),i[O]=e,this._on(t,i,n),this},emit:function(t){if("string"==typeof t)t={target:this,type:t};else if(t.target){if(t.target!=this)throw new TypeError("Event cannot be emitted on this object")}else t.target=this;return this._handleEvent(t),t},_handleEvent:function(t){var e=this._events.get(t.type);if(e)if(e._isEvent===C)this._tryEventListener(e,t)===!1&&(t.isPropagationStopped=!0);else{var n=e.length;if(1==n)this._tryEventListener(e[0],t)===!1&&(t.isPropagationStopped=!0);else{e=e.slice();for(var i=0;i<n;i++)this._tryEventListener(e[i],t)===!1&&(t.isPropagationStopped=!0)}}},_tryEventListener:function(t,e){try{return t.listener.call(t.context,e)}catch(t){this._logError(t)}},_logError:function(){_.log.apply(_,arguments)}}),j=S.extend({constructor:function(){this._valueCounts=new I},_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(t){var e=this._valueCounts,n=e.get(t);n?e.set(t,n+1):(e.set(t,1),this.adoptsValueChanges&&t instanceof S&&t.on("change",this._onItemChange,this))},_unregisterValue:function(t){var e=this._valueCounts,n=e.get(t);n>1?e.set(t,n-1):(e.delete(t),this.adoptsValueChanges&&t instanceof S&&t.off("change",this._onItemChange,this))}}),R=S.extend({Implements:[j],constructor:function t(e,n){if(S.call(this),j.call(this),"boolean"==typeof n&&(n={adoptsValueChanges:n}),this._entries=new I,this.size=0,this.adoptsValueChanges=!(!n||!n.adoptsValueChanges),e){var i=this._entries;if(e instanceof t||e instanceof I)e._entries.forEach((function(t,e){this._registerValue(t),i.set(e,t)}),this);else if(Array.isArray(e))for(var s=0,r=e.length;s<r;s++){var h=e[s];this._registerValue(h[1]),i.set(h[0],h[1])}else for(var a in e)this._registerValue(e[a]),i.set(a,e[a]);this.size=i.size}},has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var n,i=this._entries,s=i.has(t);if(s){if(n=i.get(t),x(e,n))return this;this._unregisterValue(n)}return this._registerValue(e),i.set(t,e),s||this.size++,this.emit({type:"change",subtype:s?"update":"add",key:t,oldValue:n,value:e}),this},delete:function(t){var e=this._entries;if(!e.has(t))return!1;var n=e.get(t);return this._unregisterValue(n),e.delete(t),this.size--,this.emit({type:"change",subtype:"delete",key:t,oldValue:n,value:void 0}),!0},clear:function(){return this.size?(this.adoptsValueChanges&&this._valueCounts.forEach((function(t){t instanceof S&&t.off("change",this._onItemChange,this)}),this),this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){this._entries.forEach((function(n,i){t.call(e,n,i,this)}),this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsValueChanges:this.adoptsValueChanges})}});R.prototype[p.iterator]=R.prototype.entries;var k=Array.prototype.push,P=Array.prototype.splice,T=Array.prototype.map,L=S.extend({Implements:[j],constructor:function(t,e){S.call(this),j.call(this),"boolean"==typeof e&&(e={adoptsValueChanges:e}),this._items=[],this.length=0,this.adoptsValueChanges=!(!e||!e.adoptsValueChanges),this.comparator=null,this.sorted=!1,e&&(e.sorted||e.comparator&&e.sorted!==!1)&&(this.comparator=e.comparator||i,this.sorted=!0),t&&this._addRange(t)},_validateIndex:function(t,e){if(void 0===t)return t;if(t<0){if((t+=this.length)<0)throw new RangeError("Index out of valid range")}else if(t>=this.length+(e?1:0))throw new RangeError("Index out of valid range");return t},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e,!0))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,void 0===e?-1:this._validateIndex(e,!0))},get:function(t){return this._items[this._validateIndex(t,!0)]},getRange:function(t,e){t=this._validateIndex(t,!0);var n=this._items;if(void 0===e)return n.slice(t);if(t+e>n.length)throw new RangeError('Sum of "index" and "count" out of valid range');return n.slice(t,t+e)},set:function(t,e){if(this.sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0);var n=this._items;return x(e,n[t])?this:(this._unregisterValue(n[t]),this._registerValue(e),n[t]=e,this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0),e instanceof L&&(e=e._items);var n=e.length;if(!n)return this;if(t+n>this.length)throw new RangeError('Sum of "index" and "values.length" out of valid range');for(var i=this._items,s=!1,r=t+n;r>t;){var h=e[--r-t];x(h,i[r])||(this._unregisterValue(i[r]),this._registerValue(h),i[r]=h,s=!0)}return s&&this.emit("change"),this},add:function(t){return this.sorted?this._insertValue(t):(this._registerValue(t),this._items.push(t)),this.length++,this.emit("change"),this},addRange:function(t){return t.length&&(this._addRange(t),this.emit("change")),this},_addRange:function(t){if(t instanceof L&&(t=t._items),this.sorted){for(var e=0,n=t.length;e<n;e++)this._insertValue(t[e]);this.length+=t.length}else{for(var i=t.length;i;)this._registerValue(t[--i]);this.length=k.apply(this._items,t)}},_insertValue:function(t){this._registerValue(t);for(var e=this._items,n=this.comparator,i=0,s=e.length;i!=s;){var r=i+s>>1;n(t,e[r])<0?s=r:i=r+1}e.splice(i,0,t)},insert:function(t,e){if(this.sorted)throw new TypeError("Cannot insert to sorted list");return t=this._validateIndex(t,!0),this._registerValue(e),this._items.splice(t,0,e),this.length++,this.emit("change"),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Cannot insert to sorted list");t=this._validateIndex(t,!0),e instanceof L&&(e=e._items);var n=e.length;if(!n)return this;for(var i=n;i;)this._registerValue(e[--i]);return P.apply(this._items,[t,0].concat(e)),this.length+=n,this.emit("change"),this},remove:function(t,e){var n=this._items.indexOf(t,this._validateIndex(e,!0));return n!=-1&&(this._unregisterValue(t),this._items.splice(n,1),this.length--,this.emit("change"),!0)},removeAll:function(t,e){for(var n=this._validateIndex(e,!0),i=this._items,s=!1;(n=i.indexOf(t,n))!=-1;)this._unregisterValue(t),i.splice(n,1),s=!0;return s&&(this.length=i.length,this.emit("change")),s},removeEach:function(t,e){e=this._validateIndex(e,!0),t instanceof L&&(t=t._items);for(var n=this._items,i=!1,s=0,r=t.length;s<r;s++){var h=t[s],a=n.indexOf(h,e);a!=-1&&(this._unregisterValue(h),n.splice(a,1),i=!0)}return i&&(this.length=n.length,this.emit("change")),i},removeAllEach:function(t,e){e=this._validateIndex(e,!0),t instanceof L&&(t=t._items);for(var n=this._items,i=!1,s=0,r=t.length;s<r;s++)for(var h=t[s],a=e;(a=n.indexOf(h,a))!=-1;)this._unregisterValue(h),n.splice(a,1),i=!0;return i&&(this.length=n.length,this.emit("change")),i},removeAt:function(t){var e=this._items.splice(this._validateIndex(t),1)[0];return this._unregisterValue(e),this.length--,this.emit("change"),e},removeRange:function(t,e){t=this._validateIndex(t,!0);var n=this._items;if(void 0===e)e=n.length-t;else if(t+e>n.length)throw new RangeError('Sum of "index" and "count" out of valid range');if(!e)return[];for(var i=t+e;i>t;)this._unregisterValue(n[--i]);var s=n.splice(t,e);return this.length-=e,this.emit("change"),s},clear:function(){return this.length?(this.adoptsValueChanges&&this._valueCounts.forEach((function(t){t instanceof S&&t.off("change",this._onItemChange,this)}),this),this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit({type:"change",subtype:"clear"}),this):this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,find:function(t,e){for(var n=this._items,i=0,s=n.length;i<s;i++){var r=n[i];if(t.call(e,r,i,this))return r}},findIndex:function(t,e){for(var n=this._items,i=0,s=n.length;i<s;i++)if(t.call(e,n[i],i,this))return i;return-1},every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsValueChanges:this.adoptsValueChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});["forEach","map","filter","every","some"].forEach((function(t){L.prototype[t]=function(e,n){return this._items[t]((function(t,i){return e.call(n,t,i,this)}),this)}})),["reduce","reduceRight"].forEach((function(t){L.prototype[t]=function(e,n){function i(t,n,i){return e(t,n,i,r)}var s=this._items,r=this;return arguments.length>=2?s[t](i,n):s[t](i)}})),[["keys",function(t){return t}],["values",function(t,e){return e}],["entries",function(t,e){return[t,e]}]].forEach((function(t){var e=t[1];L.prototype[t[0]]=function(){var t=this._items,n=0,i=!1;return{next:function(){if(!i){if(n<t.length)return{value:e(n,t[n++]),done:!1};i=!0}return{value:void 0,done:!0}}}}})),L.prototype[p.iterator]=L.prototype.values;var z;if(E.process&&"[object process]"==process.toString()&&process.nextTick)z=process.nextTick;else if(E.setImmediate)z=function(t){setImmediate(t)};else if(E.Promise&&Promise.toString().indexOf("[native code]")!=-1){var A=Promise.resolve();z=function(t){A.then((function(){t()}))}}else{var M;E.addEventListener("message",(function(){if(M){var t=M;M=null;for(var e=0,n=t.length;e<n;e++)try{t[e]()}catch(t){_.log(t)}}})),z=function(t){M?M.push(t):(M=[t],postMessage("__tic__","*"))}}var N,D=z,K=S.prototype,Y=Number.MAX_SAFE_INTEGER||9007199254740991,F=S.KEY_INNER,U=0,H=new I,G=Y,J=-1,X=!1,q=!1,B=null,Q={original:null},W=1,Z=0,$=!1,tt=[],et={asynchronous:!0},nt=S.extend({Static:{configure:function(t){void 0!==t.asynchronous&&(X&&r(),et.asynchronous=t.asynchronous)},autorun:function(t,e){var n;return new nt(function(){var i=this;if(n||(n=function(){i.dispose()}),Z){var s=tt.indexOf(this);s!=-1&&tt.splice(s,1),tt.push(this)}else t.call(e,n)},{onChange:s}),n},forceRelease:function(){X&&r()},transaction:function(t){!Z++&&X&&r();try{t()}catch(t){_.log(t),$=!0}if($){for(var e,n=H.values();!(e=n.next()).done;)for(var i=e.value,s=i.length;s;){var h=i[--s];h._value=h._fixedValue,h._levelInRelease=-1,h._changeEvent=null}H.clear(),G=Y,J=-1,X=!1,tt.length=0}if(!--Z&&!$){for(var s=0,a=tt.length;s<a;s++){var o=tt[s];o instanceof nt?o.pull():K._handleEvent.call(o[1],o[0])}$=!1,tt.length=0,X&&r()}},afterRelease:function(t){(N||(N=[])).push(t)}},constructor:function(t,e){S.call(this),this.owner=e&&e.owner||this,this._pull="function"==typeof t?t:null,this._get=e&&e.get||null,this._merge=e&&e.merge||null,this._put=e&&e.put||h,this._reap=e&&e.reap||null,this._pull?this._fixedValue=this._value=void 0:(this._merge&&(t=this._merge(t,void 0)),this._fixedValue=this._value=t,t instanceof S&&t.on("change",this._onValueChange,this)),this._error=null,this._pushingIndex=0,this._version=0,this._masters=void 0,this._slaves=[],this._level=0,this._levelInRelease=-1,this._changeEvent=null,this._lastErrorEvent=null,this._state=1,e&&(e.onChange&&this.on("change",e.onChange),e.onError&&this.on("error",e.onError))},_handleEvent:function(t){Z?tt.push([t,this]):K._handleEvent.call(this,t)},on:function(t,e,n){return X&&r(),this._activate(),"object"==typeof t?K.on.call(this,t,arguments.length>=2?e:this.owner):K.on.call(this,t,e,arguments.length>=3?n:this.owner),this._state|=2,this},off:function(t,e,n){X&&r();var i=arguments.length;return i?"object"==typeof t?K.off.call(this,t,i>=2?e:this.owner):K.off.call(this,t,e,i>=3?n:this.owner):K.off.call(this),!this._slaves.length&&!this._events.has("change")&&!this._events.has("error")&&2&this._state&&(this._state^=2,this._deactivate(),this._reap&&this._reap.call(this.owner)),this},addChangeListener:function(t,e){return this.on("change",t,arguments.length>=2?e:this.owner)},removeChangeListener:function(t,e){return this.off("change",t,arguments.length>=2?e:this.owner)},addErrorListener:function(t,e){return this.on("error",t,arguments.length>=2?e:this.owner)},removeErrorListener:function(t,e){return this.off("error",t,arguments.length>=2?e:this.owner)},subscribe:function(t,e){function n(e){return t.call(this,e.error||null,e)}return n[F]=t,arguments.length<2&&(e=this.owner),this.on("change",n,e).on("error",n,e)},unsubscribe:function(t,e){return arguments.length<2&&(e=this.owner),this.off("change",t,e).off("error",t,e)},_registerSlave:function(t){this._activate(),this._slaves.push(t),this._state|=2},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),this._slaves.length||this._events.has("change")||this._events.has("error")||(this._state^=2,this._deactivate(),this._reap&&this._reap.call(this.owner))},_activate:function(){if(this._pull&&!(4&this._state)&&null!==this._masters){var t=this._masters;if(this._version<W){var e=this._tryPull();!t&&!this._masters&&16&this._state||(e===Q?this._fail(Q.original,!1):this._push(e,!1,!1)),t=this._masters}if(t){var n=t.length;do{t[--n]._registerSlave(this)}while(n);this._state|=4}}},_deactivate:function(){if(4&this._state){var t=this._masters,e=t.length;do{t[--e]._unregisterSlave(this)}while(e);this._levelInRelease==-1||this._changeEvent||(this._levelInRelease=-1),this._state^=4}},_addToRelease:function(){var t=this._level;if(!(t<=this._levelInRelease)){var e;(H.get(t)||(H.set(t,e=[]),e)).push(this),G>t&&(G=t),J<t&&(J=t),this._levelInRelease=t,X||q||(X=!0,Z||et.asynchronous?D(r):r())}},_onValueChange:function(t){this._pushingIndex=++U,this._changeEvent?(t.prev=this._changeEvent,this._changeEvent=t,this._value===this._fixedValue&&(this._state^=1)):(t.prev=null,this._changeEvent=t,this._state^=1,this._addToRelease())},get:function(){if(X&&this._pull&&r(),this._pull&&!(4&this._state)&&this._version<W&&null!==this._masters){var t=this._masters,e=this._tryPull(),n=this._masters;if(t||n||!(16&this._state)){if(n&&2&this._state){var i=n.length;do{n[--i]._registerSlave(this)}while(i);this._state|=4}e===Q?this._fail(Q.original,!1):this._push(e,!1,!1)}}if(B){var s=B._masters,h=this._level;s?s.indexOf(this)==-1&&(s.push(this),B._level<=h&&(B._level=h+1)):(B._masters=[this],B._level=h+1)}return this._get?this._get(this._value):this._value},pull:function(){if(!this._pull)return!1;X&&r();var t,e,n=2&this._state;n&&(t=this._masters,e=this._level);var i=this._tryPull();if(n){var s=this._masters,h=0;if(s){var a=s.length;do{var o=s[--a];t&&t.indexOf(o)!=-1||(o._registerSlave(this),h++)}while(a)}if(t&&(s?s.length-h:0)<t.length)for(var l=t.length;l;){var u=t[--l];s&&s.indexOf(u)!=-1||u._unregisterSlave(this)}if(s&&s.length?this._state|=4:this._state^=4,q&&this._level>e)return this._addToRelease(),!1}return i===Q?(this._fail(Q.original,!1),!0):this._push(i,!1,!0)},_tryPull:function(){if(8&this._state)throw new TypeError("Circular pulling detected");var t=B;B=this,this._state|=8,this._masters=null,this._level=0;try{return this._pull.length?this._pull.call(this.owner,this,this._value):this._pull.call(this.owner)}catch(t){return Q.original=t,Q}finally{B=t,this._version=W+q,this._state^=8}},set:function(t){return this._merge&&(t=this._merge(t,this._value)),this._put.length>=3?this._put.call(this.owner,this,t,this._value):this._put.call(this.owner,this,t),this},push:function(t){return this._push(t,!0,!1),this},_push:function(t,e,n){this._state|=16;var i=this._value;if(e&&q&&2&this._state){if(x(t,i))return this._setError(null),!1;var s=this;return(N||(N=[])).push((function(){s._push(t,!0,!1)})),!0}return(e||!q&&n)&&(this._pushingIndex=++U),this._setError(null),!x(t,i)&&(this._value=t,i instanceof S&&i.off("change",this._onValueChange,this),t instanceof S&&t.on("change",this._onValueChange,this),2&this._state||Z?this._changeEvent?x(t,this._fixedValue)&&1&this._state?(this._levelInRelease=-1,this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:i,value:t,prev:this._changeEvent}:(this._changeEvent={target:this,type:"change",oldValue:i,value:t,prev:null},this._state|=1,this._addToRelease()):((e||!q&&n)&&W++,this._fixedValue=t,this._version=W+q),!0)},fail:function(t){return this._fail(t,!0),this},_fail:function(t){Z&&($=!0),this._logError(t),t instanceof Error||(t=new Error(String(t))),this._setError(t)},_setError:function(t){(t||this._error)&&(this._error=t,t&&this._handleErrorEvent({type:"error",error:t}))},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,n=0,i=e.length;n<i;n++)e[n]._handleErrorEvent(t)}},reap:function(){for(var t=this._slaves,e=0,n=t.length;e<n;e++)t[e].reap();return this.off()},dispose:function(){return this.reap()}});nt.prototype[p.iterator]=function(){return this._value[p.iterator]()},_.setHandler(a);var it={};return it.ErrorLogger=_,it.EventEmitter=S,it.ObservableCollectionMixin=j,it.ObservableMap=R,it.ObservableList=L,it.Cell=nt,it.autorun=nt.autorun,it.transact=it.transaction=nt.transaction,it.KEY_UID=m,it.KEY_CELLS=y,it.map=o,it.list=l,it.defineObservableProperty=u,it.defineObservableProperties=c,it.define=f,it.JS={is:x,Symbol:p,Map:I},it.Utils={logError:a,nextUID:t,mixin:e,createClass:n,nextTick:D,noop:s},it.cellx=it,it.__esModule=!0,it.default=it,it}));