!(function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.cellx=e()})(this,(function(){"use strict";function t(){return String(++f)}function e(t,e){for(var i=Object.getOwnPropertyNames(e),n=0,s=i.length;n<s;n++){var r=i[n];Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}return t}function i(t){var i;t.Extends?(i=t.Extends,delete t.Extends):i=Object;var n;E.call(t,"constructor")?(n=t.constructor,delete t.constructor):n=i==Object?function(){}:function(){return i.apply(this,arguments)};var s=n.prototype=Object.create(i.prototype);return t.Implements&&(t.Implements.forEach((function(t){"function"==typeof t?(Object.keys(t).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))})),e(s,t.prototype)):e(s,t)})),delete t.Implements),Object.keys(i).forEach((function(t){Object.defineProperty(n,t,Object.getOwnPropertyDescriptor(i,t))})),t.Static&&(e(n,t.Static),delete t.Static),void 0===n.extend&&(n.extend=v),e(s,t),Object.defineProperty(s,"constructor",{configurable:!0,writable:!0,value:n}),n}function n(t,e){return t<e?-1:t>e?1:0}function s(){}function r(){if(Y){Y=!1,G=!0;for(var t=U.get(H);;){var e=t&&t.shift();if(e){var i=e._level,n=e._changeEvent;if(!n){if(i>H||-1==e._levelInRelease){if(!t.length){if(H==K)break;t=U.get(++H)}continue}if(e.pull(),(i=e._level)>H){t.length||(t=U.get(++H));continue}n=e._changeEvent}if(e._levelInRelease=-1,n){var s=H;e._fixedValue=e._value,e._changeEvent=null,e._handleEvent(n);for(var r=e._pushingIndex,h=e._slaves,a=0,o=h.length;a<o;a++){var l=h[a];l._level<=i&&(l._level=i+1),r>=l._pushingIndex&&(l._pushingIndex=r,l._changeEvent=null,l._addToRelease())}if(H!=s){t=U.get(H);continue}}if(!t.length){if(H==K)break;t=U.get(++H)}}else{if(H==K)break;t=U.get(++H)}}if(H=D,K=-1,G=!1,q++,z){var u=z;z=null;for(var c=0,f=u.length;c<f;c++)u[c]()}}}function h(t,e){t.push(e)}function a(){var t=m.console;(t&&t.error||s).call(t||m,R.call(arguments,(function(t){return t===Object(t)&&t.stack||t})).join(" "))}function o(t,e,i){var n="_"+e;return t[n]=i instanceof $?i:new $(i,{owner:t}),Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:function(){return this[n].get()},set:function(t){this[n].set(t)}}),t}function l(t,e){return Object.keys(e).forEach((function(i){o(t,i,e[i])})),t}function u(t,e,i){return 3==arguments.length?o(t,e,i):l(t,e),t}var c={_handler:null,setHandler:function(t){this._handler=t},log:function(){this._handler.apply(this,arguments)}},f=0,_=Function("return this;")().Symbol;_||(_=function(e){return"__"+e+"_"+Math.floor(1e9*Math.random())+"_"+t()+"__"},_.iterator=_("Symbol.iterator"));var v,g=_,d=g("cellx.uid"),p=g("cellx.cells"),m=Function("return this;")(),y=Object.is||function(t,e){return 0===t&&0===e?1/t==1/e:t===e||t!=t&&e!=e},E=Object.prototype.hasOwnProperty;v=function(t){return t.Extends=this,i(t)};var x=m.Map;if(!x||-1==x.toString().indexOf("[native code]")){var b={value:void 0};x=i({constructor:function(t){if(this._entries=Object.create(null),this._objectStamps={},this._first=null,this._last=null,this.size=0,t)for(var e=0,i=t.length;e<i;e++)this.set(t[e][0],t[e][1])},has:function(t){return!!this._entries[this._getValueStamp(t)]},get:function(t){return(this._entries[this._getValueStamp(t)]||b).value},set:function(t,e){var i=this._entries,n=this._getValueStamp(t);if(i[n])i[n].value=e;else{var s=i[n]={key:t,keyStamp:n,value:e,prev:this._last,next:null};this.size++?this._last.next=s:this._first=s,this._last=s}return this},delete:function(t){var e=this._getValueStamp(t),i=this._entries[e];if(!i)return!1;if(--this.size){var n=i.prev,s=i.next;n?n.next=s:this._first=s,s?s.prev=n:this._last=n}else this._first=null,this._last=null;return delete this._entries[e],delete this._objectStamps[e],!0},clear:function(){var t=this._entries;for(var e in t)delete t[e];this._objectStamps={},this._first=null,this._last=null,this.size=0},_getValueStamp:function(t){switch(typeof t){case"undefined":return"undefined";case"object":if(null===t)return"null";break;case"boolean":return"?"+t;case"number":return"+"+t;case"string":return","+t}return this._getObjectStamp(t)},_getObjectStamp:function(e){if(!E.call(e,d)){if(!Object.isExtensible(e)){var i,n=this._objectStamps;for(i in n)if(E.call(n,i)&&n[i]==e)return i;return i=t(),n[i]=e,i}Object.defineProperty(e,d,{value:t()})}return e[d]},forEach:function(t,e){for(var i=this._first;i;){t.call(e,i.value,i.key,this);do{i=i.next}while(i&&!this._entries[i.keyStamp])}},toString:function(){return"[object Map]"}}),[["keys",function(t){return t.key}],["values",function(t){return t.value}],["entries",function(t){return[t.key,t.value]}]].forEach((function(t){var e=t[1];x.prototype[t[0]]=function(){var t,i=this._entries,n=!1,s=this;return{next:function(){if(!n){if(t)do{t=t.next}while(t&&!i[t.keyStamp]);else t=s._first;if(t)return{value:e(t),done:!1};n=!0}return{value:void 0,done:!0}}}}}))}x.prototype[g.iterator]||(x.prototype[g.iterator]=x.prototype.entries);var w=x,V={},O=i({Static:{currentlySubscribing:!1},constructor:function(){this._events=new w},getEvents:function(t){var e;return t?(e=this._events.get(t),e?e._isEvent===V?[e]:e:[]):(e=Object.create(null),this._events.forEach((function(t,i){e[i]=t._isEvent===V?[t]:t})),e)},on:function(t,e,i){if("object"==typeof t){i=arguments.length>=2?e:this;var n=t;for(t in n)this._on(t,n[t],i)}else this._on(t,e,arguments.length>=3?i:this);return this},off:function(t,e,i){var n=arguments.length;if(n)if("object"==typeof t){i=n>=2?e:this;var s=t;for(t in s)this._off(t,s[t],i)}else this._off(t,e,n>=3?i:this);else this._events.clear();return this},_on:function(t,e,i){var n=t.indexOf(":");if(-1!=n){var s=t.slice(n+1);O.currentlySubscribing=!0,(this["_"+s]||(this[s],this["_"+s])).on(t.slice(0,n),e,i),O.currentlySubscribing=!1}else{var r=this._events.get(t),h={_isEvent:V,listener:e,context:i};r?r._isEvent===V?this._events.set(t,[r,h]):r.push(h):this._events.set(t,h)}},_off:function(t,e,i){var n=t.indexOf(":");if(-1!=n){var s=t.slice(n+1);(this["_"+s]||(this[s],this["_"+s])).off(t.slice(0,n),e,i)}else{var r=this._events.get(t);if(!r)return;var h,a=r._isEvent===V;if(a||1==r.length)h=a?r:r[0],h.listener==e&&h.context===i&&this._events.delete(t);else for(var o=r.length;o;)if(h=r[--o],h.listener==e&&h.context===i){r.splice(o,1);break}}},once:function(t,e,i){function n(s){return this._off(t,n,i),e.call(this,s)}return arguments.length<3&&(i=this),this._on(t,n,i),n},emit:function(t){if("string"==typeof t)t={target:this,type:t};else if(t.target){if(t.target!=this)throw new TypeError("Event cannot be emitted on this object")}else t.target=this;return this._handleEvent(t),t},_handleEvent:function(t){var e=this._events.get(t.type);if(e)if(e._isEvent===V)!1===this._tryEventListener(e,t)&&(t.isPropagationStopped=!0);else{var i=e.length;if(1==i)!1===this._tryEventListener(e[0],t)&&(t.isPropagationStopped=!0);else{e=e.slice();for(var n=0;n<i;n++)!1===this._tryEventListener(e[n],t)&&(t.isPropagationStopped=!0)}}},_tryEventListener:function(t,e){try{return t.listener.call(t.context,e)}catch(t){this._logError(t)}},_logError:function(){c.log.apply(c,arguments)}}),I=O.extend({constructor:function(){this._valueCounts=new w},_onItemChange:function(t){this._handleEvent(t)},_registerValue:function(t){var e=this._valueCounts,i=e.get(t);i?e.set(t,i+1):(e.set(t,1),this.adoptsValueChanges&&t instanceof O&&t.on("change",this._onItemChange,this))},_unregisterValue:function(t){var e=this._valueCounts,i=e.get(t);i>1?e.set(t,i-1):(e.delete(t),this.adoptsValueChanges&&t instanceof O&&t.off("change",this._onItemChange,this))}}),S=O.extend({Implements:[I],constructor:function t(e,i){if(O.call(this),I.call(this),"boolean"==typeof i&&(i={adoptsValueChanges:i}),this._entries=new w,this.size=0,this.adoptsValueChanges=!(!i||!i.adoptsValueChanges),e){var n=this._entries;if(e instanceof t||e instanceof w)e._entries.forEach((function(t,e){this._registerValue(t),n.set(e,t)}),this);else if(Array.isArray(e))for(var s=0,r=e.length;s<r;s++){var h=e[s];this._registerValue(h[1]),n.set(h[0],h[1])}else for(var a in e)this._registerValue(e[a]),n.set(a,e[a]);this.size=n.size}},has:function(t){return this._entries.has(t)},contains:function(t){return this._valueCounts.has(t)},get:function(t){return this._entries.get(t)},set:function(t,e){var i,n=this._entries,s=n.has(t);if(s){if(i=n.get(t),y(e,i))return this;this._unregisterValue(i)}return this._registerValue(e),n.set(t,e),s||this.size++,this.emit({type:"change",subtype:s?"update":"add",key:t,oldValue:i,value:e}),this},delete:function(t){var e=this._entries;if(!e.has(t))return!1;var i=e.get(t);return this._unregisterValue(i),e.delete(t),this.size--,this.emit({type:"change",subtype:"delete",key:t,oldValue:i,value:void 0}),!0},clear:function(){return this.size?(this.adoptsValueChanges&&this._valueCounts.forEach((function(t){t instanceof O&&t.off("change",this._onItemChange,this)}),this),this._entries.clear(),this._valueCounts.clear(),this.size=0,this.emit({type:"change",subtype:"clear"}),this):this},forEach:function(t,e){this._entries.forEach((function(i,n){t.call(e,i,n,this)}),this)},keys:function(){return this._entries.keys()},values:function(){return this._entries.values()},entries:function(){return this._entries.entries()},clone:function(){return new this.constructor(this,{adoptsValueChanges:this.adoptsValueChanges})}});S.prototype[g.iterator]=S.prototype.entries;var C=Array.prototype.push,j=Array.prototype.splice,R=Array.prototype.map,k=O.extend({Implements:[I],constructor:function(t,e){O.call(this),I.call(this),"boolean"==typeof e&&(e={adoptsValueChanges:e}),this._items=[],this.length=0,this.adoptsValueChanges=!(!e||!e.adoptsValueChanges),this.comparator=null,this.sorted=!1,e&&(e.sorted||e.comparator&&!1!==e.sorted)&&(this.comparator=e.comparator||n,this.sorted=!0),t&&this._addRange(t)},_validateIndex:function(t,e){if(void 0===t)return t;if(t<0){if((t+=this.length)<0)throw new RangeError("Index out of valid range")}else if(t>=this.length+(e?1:0))throw new RangeError("Index out of valid range");return t},contains:function(t){return this._valueCounts.has(t)},indexOf:function(t,e){return this._items.indexOf(t,this._validateIndex(e,!0))},lastIndexOf:function(t,e){return this._items.lastIndexOf(t,void 0===e?-1:this._validateIndex(e,!0))},get:function(t){return this._items[this._validateIndex(t,!0)]},getRange:function(t,e){t=this._validateIndex(t,!0);var i=this._items;if(void 0===e)return i.slice(t);if(t+e>i.length)throw new RangeError('Sum of "index" and "count" out of valid range');return i.slice(t,t+e)},set:function(t,e){if(this.sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0);var i=this._items;return y(e,i[t])?this:(this._unregisterValue(i[t]),this._registerValue(e),i[t]=e,this.emit("change"),this)},setRange:function(t,e){if(this.sorted)throw new TypeError("Cannot set to sorted list");t=this._validateIndex(t,!0),e instanceof k&&(e=e._items);var i=e.length;if(!i)return this;if(t+i>this.length)throw new RangeError('Sum of "index" and "values.length" out of valid range');for(var n=this._items,s=!1,r=t+i;r>t;){var h=e[--r-t];y(h,n[r])||(this._unregisterValue(n[r]),this._registerValue(h),n[r]=h,s=!0)}return s&&this.emit("change"),this},add:function(t){return this.sorted?this._insertValue(t):(this._registerValue(t),this._items.push(t)),this.length++,this.emit("change"),this},addRange:function(t){return t.length&&(this._addRange(t),this.emit("change")),this},_addRange:function(t){if(t instanceof k&&(t=t._items),this.sorted){for(var e=0,i=t.length;e<i;e++)this._insertValue(t[e]);this.length+=t.length}else{for(var n=t.length;n;)this._registerValue(t[--n]);this.length=C.apply(this._items,t)}},_insertValue:function(t){this._registerValue(t);for(var e=this._items,i=this.comparator,n=0,s=e.length;n!=s;){var r=n+s>>1;i(t,e[r])<0?s=r:n=r+1}e.splice(n,0,t)},insert:function(t,e){if(this.sorted)throw new TypeError("Cannot insert to sorted list");return t=this._validateIndex(t,!0),this._registerValue(e),this._items.splice(t,0,e),this.length++,this.emit("change"),this},insertRange:function(t,e){if(this.sorted)throw new TypeError("Cannot insert to sorted list");t=this._validateIndex(t,!0),e instanceof k&&(e=e._items);var i=e.length;if(!i)return this;for(var n=i;n;)this._registerValue(e[--n]);return j.apply(this._items,[t,0].concat(e)),this.length+=i,this.emit("change"),this},remove:function(t,e){var i=this._items.indexOf(t,this._validateIndex(e,!0));return-1!=i&&(this._unregisterValue(t),this._items.splice(i,1),this.length--,this.emit("change"),!0)},removeAll:function(t,e){for(var i=this._validateIndex(e,!0),n=this._items,s=!1;-1!=(i=n.indexOf(t,i));)this._unregisterValue(t),n.splice(i,1),s=!0;return s&&(this.length=n.length,this.emit("change")),s},removeEach:function(t,e){e=this._validateIndex(e,!0),t instanceof k&&(t=t._items);for(var i=this._items,n=!1,s=0,r=t.length;s<r;s++){var h=t[s],a=i.indexOf(h,e);-1!=a&&(this._unregisterValue(h),i.splice(a,1),n=!0)}return n&&(this.length=i.length,this.emit("change")),n},removeAllEach:function(t,e){e=this._validateIndex(e,!0),t instanceof k&&(t=t._items);for(var i=this._items,n=!1,s=0,r=t.length;s<r;s++)for(var h=t[s],a=e;-1!=(a=i.indexOf(h,a));)this._unregisterValue(h),i.splice(a,1),n=!0;return n&&(this.length=i.length,this.emit("change")),n},removeAt:function(t){var e=this._items.splice(this._validateIndex(t),1)[0];return this._unregisterValue(e),this.length--,this.emit("change"),e},removeRange:function(t,e){t=this._validateIndex(t,!0);var i=this._items;if(void 0===e)e=i.length-t;else if(t+e>i.length)throw new RangeError('Sum of "index" and "count" out of valid range');if(!e)return[];for(var n=t+e;n>t;)this._unregisterValue(i[--n]);var s=i.splice(t,e);return this.length-=e,this.emit("change"),s},clear:function(){return this.length?(this.adoptsValueChanges&&this._valueCounts.forEach((function(t){t instanceof O&&t.off("change",this._onItemChange,this)}),this),this._items.length=0,this._valueCounts.clear(),this.length=0,this.emit({type:"change",subtype:"clear"}),this):this},join:function(t){return this._items.join(t)},forEach:null,map:null,filter:null,find:function(t,e){for(var i=this._items,n=0,s=i.length;n<s;n++){var r=i[n];if(t.call(e,r,n,this))return r}},findIndex:function(t,e){for(var i=this._items,n=0,s=i.length;n<s;n++)if(t.call(e,i[n],n,this))return n;return-1},every:null,some:null,reduce:null,reduceRight:null,clone:function(){return new this.constructor(this,{adoptsValueChanges:this.adoptsValueChanges,comparator:this.comparator,sorted:this.sorted})},toArray:function(){return this._items.slice()},toString:function(){return this._items.join()}});["forEach","map","filter","every","some"].forEach((function(t){k.prototype[t]=function(e,i){return this._items[t]((function(t,n){return e.call(i,t,n,this)}),this)}})),["reduce","reduceRight"].forEach((function(t){k.prototype[t]=function(e,i){function n(t,i,n){return e(t,i,n,r)}var s=this._items,r=this;return arguments.length>=2?s[t](n,i):s[t](n)}})),[["keys",function(t){return t}],["values",function(t,e){return e}],["entries",function(t,e){return[t,e]}]].forEach((function(t){var e=t[1];k.prototype[t[0]]=function(){var t=this._items,i=0,n=!1;return{next:function(){if(!n){if(i<t.length)return{value:e(i,t[i++]),done:!1};n=!0}return{value:void 0,done:!0}}}}})),k.prototype[g.iterator]=k.prototype.values;var P;if(m.process&&"[object process]"==process.toString()&&process.nextTick)P=process.nextTick;else if(m.setImmediate)P=function(t){setImmediate(t)};else if(m.Promise&&-1!=Promise.toString().indexOf("[native code]")){var T=Promise.resolve();P=function(t){T.then((function(){t()}))}}else{var L;m.addEventListener("message",(function(){if(L){var t=L;L=null;for(var e=0,i=t.length;e<i;e++)try{t[e]()}catch(t){c.log(t)}}})),P=function(t){L?L.push(t):(L=[t],postMessage("__tic__","*"))}}var z,A=P,M=O.prototype,D=Number.MAX_SAFE_INTEGER||9007199254740991,F=g("wrappers"),N=0,U=new w,H=D,K=-1,Y=!1,G=!1,J=null,X={original:null},q=1,B=0,Q=!1,W=[],Z={asynchronous:!0},$=O.extend({Static:{configure:function(t){void 0!==t.asynchronous&&(Y&&r(),Z.asynchronous=t.asynchronous)},get currentlyPulling(){return!!J},autorun:function(t,e){var i;return new $(function(){var n=this;if(i||(i=function(){n.dispose()}),B){var s=W.indexOf(this);-1!=s&&W.splice(s,1),W.push(this)}else t.call(e,i)},{onChange:s}),i},forceRelease:function(){Y&&r()},transaction:function(t){!B++&&Y&&r();try{t()}catch(t){c.log(t),Q=!0}if(Q){for(var e,i=U.values();!(e=i.next()).done;)for(var n=e.value,s=n.length;s;){var h=n[--s];h._value=h._fixedValue,h._levelInRelease=-1,h._changeEvent=null}U.clear(),H=D,K=-1,Y=!1,W.length=0}if(!--B&&!Q){for(var s=0,a=W.length;s<a;s++){var o=W[s];o instanceof $?o.pull():M._handleEvent.call(o[1],o[0])}Q=!1,W.length=0,Y&&r()}},afterRelease:function(t){(z||(z=[])).push(t)}},constructor:function(t,e){O.call(this),this.owner=e&&e.owner||this,this._pull="function"==typeof t?t:null,this._get=e&&e.get||null,this._merge=e&&e.merge||null,this._put=e&&e.put||h,this._reap=e&&e.reap||null,this._pull?this._fixedValue=this._value=void 0:(this._merge&&(t=this._merge(t,void 0)),this._fixedValue=this._value=t,t instanceof O&&t.on("change",this._onValueChange,this)),this._error=null,this._pushingIndex=0,this._version=0,this._masters=void 0,this._slaves=[],this._level=0,this._levelInRelease=-1,this._changeEvent=null,this._lastErrorEvent=null,this._state=1,e&&(e.onChange&&this.on("change",e.onChange),e.onError&&this.on("error",e.onError))},_handleEvent:function(t){B?W.push([t,this]):M._handleEvent.call(this,t)},on:function(t,e,i){return Y&&r(),this._activate(),"object"==typeof t?M.on.call(this,t,arguments.length>=2?e:this.owner):M.on.call(this,t,e,arguments.length>=3?i:this.owner),this._state|=2,this},off:function(t,e,i){Y&&r();var n=arguments.length;return n?"object"==typeof t?M.off.call(this,t,n>=2?e:this.owner):M.off.call(this,t,e,n>=3?i:this.owner):M.off.call(this),!this._slaves.length&&!this._events.has("change")&&!this._events.has("error")&&2&this._state&&(this._state^=2,this._deactivate(),this._reap&&this._reap.call(this.owner)),this},addChangeListener:function(t,e){return this.on("change",t,arguments.length>=2?e:this.owner)},removeChangeListener:function(t,e){return this.off("change",t,arguments.length>=2?e:this.owner)},addErrorListener:function(t,e){return this.on("error",t,arguments.length>=2?e:this.owner)},removeErrorListener:function(t,e){return this.off("error",t,arguments.length>=2?e:this.owner)},subscribe:function(t,e){function i(e){return t.call(this,e.error||null,e)}var n=t[F];return n&&n.has(t)?this:((n||(t[F]=new w)).set(this,i),arguments.length<2&&(e=this.owner),this.on("change",i,e).on("error",i,e))},unsubscribe:function(t,e){arguments.length<2&&(e=this.owner);var i=t[F],n=i&&i.get(this);return n?(i.delete(this),this.off("change",n,e).off("error",n,e)):this},_registerSlave:function(t){this._activate(),this._slaves.push(t),this._state|=2},_unregisterSlave:function(t){this._slaves.splice(this._slaves.indexOf(t),1),this._slaves.length||this._events.has("change")||this._events.has("error")||(this._state^=2,this._deactivate(),this._reap&&this._reap.call(this.owner))},_activate:function(){if(this._pull&&!(4&this._state)&&null!==this._masters){var t=this._masters;if(this._version<q){var e=this._tryPull();!t&&!this._masters&&16&this._state||(e===X?this._fail(X.original,!1):this._push(e,!1,!1)),t=this._masters}if(t){var i=t.length;do{t[--i]._registerSlave(this)}while(i);this._state|=4}}},_deactivate:function(){if(4&this._state){var t=this._masters,e=t.length;do{t[--e]._unregisterSlave(this)}while(e);-1==this._levelInRelease||this._changeEvent||(this._levelInRelease=-1),this._state^=4}},_addToRelease:function(){var t=this._level;if(!(t<=this._levelInRelease)){var e;(U.get(t)||(U.set(t,e=[]),e)).push(this),H>t&&(H=t),K<t&&(K=t),this._levelInRelease=t,Y||G||(Y=!0,B||Z.asynchronous?A(r):r())}},_onValueChange:function(t){this._pushingIndex=++N,this._changeEvent?(t.prev=this._changeEvent,this._changeEvent=t,this._value===this._fixedValue&&(this._state&=-2)):(t.prev=null,this._changeEvent=t,this._state&=-2,this._addToRelease())},get:function(){if(Y&&this._pull&&r(),this._pull&&!(4&this._state)&&this._version<q&&null!==this._masters){var t=this._masters,e=this._tryPull(),i=this._masters;if(t||i||!(16&this._state)){if(i&&2&this._state){var n=i.length;do{i[--n]._registerSlave(this)}while(n);this._state|=4}e===X?this._fail(X.original,!1):this._push(e,!1,!1)}}if(J){var s=J._masters,h=this._level;s?-1==s.indexOf(this)&&(s.push(this),J._level<=h&&(J._level=h+1)):(J._masters=[this],J._level=h+1)}return this._get?this._get(this._value):this._value},pull:function(){if(!this._pull)return!1;Y&&r();var t,e,i=2&this._state;i&&(t=this._masters,e=this._level);var n=this._tryPull();if(i){var s=this._masters,h=0;if(s){var a=s.length;do{var o=s[--a];t&&-1!=t.indexOf(o)||(o._registerSlave(this),h++)}while(a)}if(t&&(s?s.length-h:0)<t.length)for(var l=t.length;l;){var u=t[--l];s&&-1!=s.indexOf(u)||u._unregisterSlave(this)}if(s&&s.length?this._state|=4:this._state&=-5,G&&this._level>e)return this._addToRelease(),!1}return n===X?(this._fail(X.original,!1),!0):this._push(n,!1,!0)},_tryPull:function(){if(8&this._state)throw new TypeError("Circular pulling detected");var t=J;J=this,this._state|=8,this._masters=null,this._level=0;try{return this._pull.length?this._pull.call(this.owner,this,this._value):this._pull.call(this.owner)}catch(t){return X.original=t,X}finally{J=t,this._version=q+G,this._state^=8}},set:function(t){return this._merge&&(t=this._merge(t,this._value)),this._put.length>=3?this._put.call(this.owner,this,t,this._value):this._put.call(this.owner,this,t),this},push:function(t){return this._push(t,!0,!1),this},_push:function(t,e,i){this._state|=16;var n=this._value;if(e&&G&&2&this._state){if(y(t,n))return this._setError(null),!1;var s=this;return(z||(z=[])).push((function(){s._push(t,!0,!1)})),!0}return(e||!G&&i)&&(this._pushingIndex=++N),this._setError(null),!y(t,n)&&(this._value=t,n instanceof O&&n.off("change",this._onValueChange,this),t instanceof O&&t.on("change",this._onValueChange,this),2&this._state||B?this._changeEvent?y(t,this._fixedValue)&&1&this._state?(this._levelInRelease=-1,this._changeEvent=null):this._changeEvent={target:this,type:"change",oldValue:n,value:t,prev:this._changeEvent}:(this._changeEvent={target:this,type:"change",oldValue:n,value:t,prev:null},this._state|=1,this._addToRelease()):((e||!G&&i)&&q++,this._fixedValue=t,this._version=q+G),!0)},fail:function(t){return this._fail(t,!0),this},_fail:function(t){B&&(Q=!0),this._logError(t),t instanceof Error||(t=new Error(String(t))),this._setError(t)},_setError:function(t){(t||this._error)&&(this._error=t,t&&this._handleErrorEvent({type:"error",error:t}))},_handleErrorEvent:function(t){if(this._lastErrorEvent!==t){this._lastErrorEvent=t,this._handleEvent(t);for(var e=this._slaves,i=0,n=e.length;i<n;i++)e[i]._handleErrorEvent(t)}},reap:function(){for(var t=this._slaves,e=0,i=t.length;e<i;e++)t[e].reap();return this.off()},dispose:function(){return this.reap()}});$.prototype[g.iterator]=function(){return this._value[g.iterator]()},c.setHandler(a);var tt={};return tt.ErrorLogger=c,tt.EventEmitter=O,tt.ObservableCollectionMixin=I,tt.ObservableMap=S,tt.ObservableList=k,tt.Cell=$,tt.autorun=$.autorun,tt.transact=tt.transaction=$.transaction,tt.KEY_UID=d,tt.KEY_CELLS=p,tt.defineObservableProperty=o,tt.defineObservableProperties=l,tt.define=u,tt.JS=tt.js={is:y,Symbol:g,Map:w},tt.Utils=tt.utils={logError:a,nextUID:t,mixin:e,createClass:i,nextTick:A,noop:s},tt.cellx=tt,tt.__esModule=!0,tt.default=tt,tt}));